import{r as a,j as e}from"./index-COn31sPo.js";const v=5e3,N=({children:s,...t})=>e.jsxs("div",{className:"mb-4 rounded border border-blue-200 bg-blue-50 p-4",...t,children:[e.jsx("div",{className:"mb-2 text-sm text-blue-700",children:"📋 Tabs 组件（安全模式）"}),s]}),T=({children:s,label:t,...r})=>e.jsxs("div",{className:"mb-4 rounded border border-blue-100 bg-white p-3",...r,children:[e.jsx("div",{className:"mb-2 font-medium text-blue-600",children:t}),e.jsx("div",{className:"whitespace-pre-wrap",children:s})]});function w(s,t,r={}){a.useEffect(()=>{const n=s.current;if(!n)return;const c=new IntersectionObserver(([o])=>{o.isIntersecting&&t()},r);return c.observe(n),()=>c.disconnect()},[s,t,r])}const f=({content:s,className:t})=>{const r=a.useMemo(()=>{try{const{compiler:n}=require("markdown-to-jsx");if(/<Tabs[^>]*>[\s\S]*?<\/Tabs>/i.test(s)||/<tab\s+label=/i.test(s))try{const o=require("../renderers/simple-tabs"),{SimpleTab:d,SimpleTabs:h}=o;if(!d||!h)throw new Error("SimpleTabs components not found");return n(s,{wrapper:null,overrides:{Tabs:h,tab:d}})}catch(o){return console.error("Failed to import SimpleTabs:",o),n(s,{wrapper:null,overrides:{Tabs:N,tab:T}})}return n(s,{wrapper:null})}catch(n){return console.error("ContentChunk render error:",n),e.jsxs("div",{className:"rounded border border-red-200 bg-red-50 p-4",children:[e.jsx("p",{className:"text-red-800",children:"内容渲染失败，显示原始文本："}),e.jsx("pre",{className:"mt-2 whitespace-pre-wrap text-sm",children:s})]})}},[s]);return e.jsx("div",{className:t,children:r})},y=({onIntersect:s})=>{const t=a.useRef(null);return w(t,s,{threshold:.1,rootMargin:"100px"}),e.jsx("div",{ref:t,className:"h-4"})},E=({content:s,className:t=""})=>{const r=a.useMemo(()=>(i=>{if(i.length<=v)return[i];const x=[];let b=0;for(;b<i.length;){let l=b+v;if(l<i.length){const C=Math.min(l+1e3,i.length),j=i.slice(l,C),m=j.match(/\n\s*\n/);if(m&&m.index!==void 0)l=l+m.index+m[0].length;else{const p=j.match(/[.!?]\s*\n/);p&&p.index!==void 0&&(l=l+p.index+p[0].length)}}else l=i.length;const g=i.slice(b,l).trim();g&&x.push(g),b=l}return x.length>0?x:[i]})(s),[s]),[n,c]=a.useState(1),[o,d]=a.useState(!1),h=a.useCallback(()=>{o||n>=r.length||(d(!0),setTimeout(()=>{c(u=>Math.min(u+1,r.length)),d(!1)},100))},[o,n,r.length]);return r.length>1?e.jsxs("div",{className:t,children:[r.slice(0,n).map((u,i)=>e.jsx("div",{className:"mb-6",children:e.jsx(f,{content:u})},`chunk-${i}-${u.slice(0,20).replaceAll(/\s+/g,"")}`)),n<r.length&&e.jsx("div",{className:"py-6 text-center",children:o?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"size-4 animate-spin rounded-full border-2 border-blue-500 border-t-transparent"}),e.jsx("span",{className:"text-gray-600",children:"加载中..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:h,className:"rounded bg-blue-500 px-4 py-2 text-white transition-colors hover:bg-blue-600",children:["加载更多内容 (",n,"/",r.length,")"]}),e.jsx(y,{onIntersect:h})]})}),n>=r.length&&r.length>1&&e.jsxs("div",{className:"border-t border-gray-200 py-4 text-center text-gray-500",children:["✅ 全部内容已加载完成 (",r.length," 个部分)"]})]}):e.jsx("div",{className:t,children:e.jsx(f,{content:s})})};export{E as LongContentMarkdown};
